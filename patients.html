<!DOCTYPE html>
<html lang="uz">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShifoCRM Demo - Tibbiy Amaliyot Boshqaruv Tizimi</title>
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <script>tailwind.config = { theme: { extend: { colors: { primary: '#2E7D32', secondary: '#4CAF50' }, borderRadius: { 'none': '0px', 'sm': '4px', DEFAULT: '8px', 'md': '12px', 'lg': '16px', 'xl': '20px', '2xl': '24px', '3xl': '32px', 'full': '9999px', 'button': '8px' } } } }</script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"></script>
    <style>
        :where([class^="ri-"])::before {
            content: "\f3c2";
        }

        .demo-badge {
            background: linear-gradient(45deg, #FF6B6B, #FF8E53);
        }

        .sidebar-transition {
            transition: transform 0.3s ease-in-out;
        }

        .modal-backdrop {
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<!-- Patients Section -->
<div id="patients-section" class="section active">
    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
        <!-- Search and Add New Patient -->
        <div class="p-6 border-b border-gray-200 flex justify-between items-center">
            <input id="searchInput" type="text" placeholder="Bemor qidirish..."
                class="w-1/2 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm">
            <button id="addPatientBtn" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90">+ Yangi
                bemor</button>
        </div>

        <!-- Patients Table -->
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            F.I.O.</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Telefon</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Oxirgi tashrif</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Status</th>
                    </tr>
                </thead>
                <tbody id="patientsTableBody" class="bg-white divide-y divide-gray-200">
                    <!-- JS orqali toâ€˜ldiriladi -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<div id="addPatientModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-white p-6 rounded-lg w-full max-w-md">
        <h3 class="text-lg font-semibold mb-4">Yangi bemor qoâ€˜shish</h3>
        <form id="addPatientForm" class="space-y-4">
            <input type="text" name="name" placeholder="Ism Familiya" required
                class="w-full px-4 py-2 border rounded-lg">
            <input type="number" name="age" placeholder="Yoshi" required class="w-full px-4 py-2 border rounded-lg">
            <input type="text" name="phone" placeholder="Telefon" required class="w-full px-4 py-2 border rounded-lg">
            <input type="date" name="lastVisit" required class="w-full px-4 py-2 border rounded-lg">
            <select name="status" required class="w-full px-4 py-2 border rounded-lg">
                <option value="Faol">Faol</option>
                <option value="Kutilmoqda">Kutilmoqda</option>
                <option value="Yakunlangan">Yakunlangan</option>
            </select>
            <div class="flex justify-end gap-2">
                <button type="button" id="cancelAddPatient" class="px-4 py-2 border rounded-lg">Bekor qilish</button>
                <button type="submit" class="bg-primary text-white px-4 py-2 rounded-lg">Saqlash</button>
            </div>
        </form>
    </div>
</div>

<script>

    document.addEventListener('DOMContentLoaded', function () {
        const API_URL = "http://localhost:3000/patients";
        const tableBody = document.getElementById('patientsTableBody');
        const addPatientBtn = document.getElementById('addPatientBtn');
        const addPatientModal = document.getElementById('addPatientModal');
        const cancelAddPatient = document.getElementById('cancelAddPatient');
        const addPatientForm = document.getElementById('addPatientForm');
        const searchInput = document.getElementById('searchInput');

        // ðŸŸ¢ Bemorlarni olish
        function loadPatients(query = "") {
            fetch(API_URL)
                .then(res => res.json())
                .then(data => {
                    let filtered = data.filter(p =>
                        p.name.toLowerCase().includes(query.toLowerCase())
                    );
                    renderPatients(filtered);
                });
        }

        // ðŸŸ¢ Jadvalni toâ€˜ldirish
        function renderPatients(patients) {
            tableBody.innerHTML = "";
            patients.forEach(p => {
                const row = `
                <tr>
                    <td class="px-6 py-4">${p.name} <br><small>${p.age} yosh</small></td>
                    <td class="px-6 py-4">${p.phone}</td>
                    <td class="px-6 py-4">${p.lastVisit}</td>
                    <td class="px-6 py-4">${p.status}</td>
                </tr>
            `;
                tableBody.innerHTML += row;
            });
        }

        // ðŸŸ¢ Yangi bemor qoâ€˜shish
        addPatientForm.addEventListener('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(addPatientForm);
            const newPatient = {
                name: formData.get('name'),
                age: parseInt(formData.get('age')),
                phone: formData.get('phone'),
                lastVisit: formData.get('lastVisit'),
                status: formData.get('status')
            };
            fetch(API_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(newPatient)
            })
                .then(res => res.json())
                .then(() => {
                    loadPatients();
                    addPatientModal.classList.add('hidden');
                    addPatientForm.reset();
                });
        });

        // ðŸŸ¢ Modal boshqarish
        addPatientBtn.addEventListener('click', () => addPatientModal.classList.remove('hidden'));
        cancelAddPatient.addEventListener('click', () => addPatientModal.classList.add('hidden'));

        // ðŸŸ¢ Qidirish
        searchInput.addEventListener('input', () => {
            loadPatients(searchInput.value);
        });

        // Boshlangâ€˜ich yuklash
        loadPatients();
    });

</script>