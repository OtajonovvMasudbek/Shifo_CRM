<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shifokor Profili - ShifoCRM</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css" rel="stylesheet" />
  <style>
    @media (max-width: 1023px) {
      .desktop-sidebar { display: none; }
      .mobile-bottom-nav { display: flex; }
    }
    @media (min-width: 1024px) {
      .mobile-bottom-nav { display: none; }
    }
    .modal-bg {
      background: rgba(0,0,0,0.5);
      backdrop-filter: blur(4px);
    }
  </style>
</head>

<body class="bg-gray-50 flex min-h-screen font-sans">

  <!-- ü©∫ Sidebar -->
  <aside id="sidebar" class="desktop-sidebar w-64 bg-white shadow-xl flex flex-col h-screen fixed lg:relative z-40">
    <div class="p-6 border-b border-gray-200 flex items-center gap-3">
      <div class="w-10 h-10 bg-green-600 rounded-lg flex items-center justify-center text-white">
        <i class="ri-hospital-line text-xl"></i>
      </div>
      <div>
        <h1 class="font-semibold text-green-700 text-lg">ShifoCRM</h1>
        <span class="text-xs bg-gradient-to-r from-red-500 to-orange-400 text-white px-2 py-0.5 rounded-full">DEMO</span>
      </div>
    </div>
    <nav class="flex-1 p-4 space-y-2">
      <a href="./patients.html" class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-green-600 hover:text-white transition">
        <i class="ri-user-heart-line"></i> Bemorlar
      </a>
      <a href="./dental_chart.html" class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-green-600 hover:text-white transition">
        <i class="ri-tooth-line"></i> Dental Chart
      </a>
      <a href="./profil.html" class="flex items-center gap-3 px-4 py-3 rounded-lg bg-green-100 text-green-700 font-medium">
        <i class="ri-user-settings-line"></i> Profil
      </a>
    </nav>
    <div class="p-4 border-t border-gray-200">
      <a href="./register.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-red-600 hover:bg-red-50">
        <i class="ri-logout-box-line"></i> Chiqish
      </a>
    </div>
  </aside>

  <!-- üîπ Asosiy qism -->
  <div class="flex-1 flex flex-col">
    <!-- Header -->
    <header class="bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center shadow-sm sticky top-0 z-20">
      <div class="flex items-center gap-3">
        <button id="openSidebar" class="lg:hidden text-green-700">
          <i class="ri-menu-line text-2xl"></i>
        </button>
        <h1 class="text-xl font-semibold flex items-center gap-2 text-green-700">
          <i class="ri-user-heart-line text-2xl"></i> Shifokor profili
        </h1>
      </div>
      <div class="flex items-center gap-2 bg-green-50 border border-green-100 px-3 py-1 rounded-full">
        <div id="profileAvatar" class="w-9 h-9 bg-green-600 rounded-full text-white flex items-center justify-center font-semibold">D</div>
        <span id="profileName" class="font-medium text-green-700">---</span>
      </div>
    </header>

    <!-- Main -->
    <main class="flex-1 p-6 overflow-y-auto">
      <div class="max-w-2xl mx-auto bg-white p-6 rounded-2xl shadow-lg">
        <div class="flex justify-between items-center mb-5">
          <h2 class="text-2xl font-semibold text-green-700 flex items-center gap-2">
            <i class="ri-user-3-line"></i> Shaxsiy ma‚Äôlumotlar
          </h2>
          <button id="editBtn" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex items-center gap-2">
            <i class="ri-edit-line"></i> Tahrirlash
          </button>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-gray-700">
          <p><b>üë®‚Äç‚öïÔ∏è F.I.O:</b> <span id="fullname">-</span></p>
          <p><b>üìß Login:</b> <span id="username">-</span></p>
          <p><b>üîë Parol:</b> <span id="password">-</span></p>
          <p><b>üì± Telefon:</b> <span id="phone">-</span></p>
        </div>
      </div>

      <!-- üîî Eslatmalar -->
      <div class="max-w-2xl mx-auto bg-white p-6 rounded-2xl shadow-lg mt-8">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-2xl font-semibold text-green-700 flex items-center gap-2">
            <i class="ri-notification-2-line"></i> Eslatmalar
          </h2>
          <button id="addReminderBtn" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex items-center gap-2">
            <i class="ri-add-line"></i> Yangi
          </button>
        </div>
        <ul id="reminderList" class="space-y-3 text-gray-700"></ul>
      </div>

      <div class="mt-8 flex justify-end">
        <button onclick="logout()" class="bg-red-500 text-white px-5 py-2 rounded-lg hover:bg-red-600 flex items-center gap-2">
          <i class="ri-logout-box-line"></i> Chiqish
        </button>
      </div>
    </main>
  </div>

  <!-- ‚úèÔ∏è Edit Modal -->
  <div id="editModal" class="hidden fixed inset-0 modal-bg flex items-center justify-center z-50 px-4">
    <div class="bg-white rounded-2xl p-6 w-full max-w-md shadow-2xl">
      <h3 class="text-xl font-semibold text-green-700 mb-4 flex items-center gap-2"><i class="ri-edit-line"></i> Ma‚Äôlumotlarni tahrirlash</h3>
      <form id="editForm" class="space-y-3">
        <input id="editFullname" type="text" placeholder="F.I.O" class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500" />
        <input id="editUsername" type="text" placeholder="Login" class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500" />
        <input id="editPassword" type="password" placeholder="Parol" class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500" />
        <input id="editPhone" type="text" placeholder="Telefon raqam" class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500" />
        <div class="flex justify-end gap-3 pt-2">
          <button type="button" id="cancelEdit" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg">Bekor</button>
          <button type="submit" class="px-4 py-2 bg-green-600 text-white hover:bg-green-700 rounded-lg">Saqlash</button>
        </div>
      </form>
    </div>
  </div>

  <!-- üîî Reminder Modal -->
  <div id="reminderModal" class="hidden fixed inset-0 modal-bg flex items-center justify-center z-50 px-4">
    <div class="bg-white rounded-2xl p-6 w-full max-w-md shadow-2xl">
      <h3 id="modalTitle" class="text-xl font-semibold text-green-700 mb-4 flex items-center gap-2">
        <i class="ri-notification-3-line"></i> Yangi eslatma
      </h3>
      <form id="reminderForm" class="space-y-3">
        <input id="reminderText" type="text" placeholder="Eslatma matni..." class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500" />
        <input id="reminderDate" type="datetime-local" class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500" />
        <div class="flex justify-end gap-3 pt-2">
          <button type="button" id="cancelReminder" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg">Bekor</button>
          <button type="submit" class="px-4 py-2 bg-green-600 text-white hover:bg-green-700 rounded-lg">Saqlash</button>
        </div>
      </form>
    </div>
  </div>

  <!-- üì± Mobile bottom nav -->
  <nav class="mobile-bottom-nav fixed bottom-0 left-0 right-0 bg-white shadow-2xl z-50 hidden">
    <ul class="flex justify-around items-center h-16">
      <li><a href="./patients.html" class="flex flex-col items-center text-gray-400 hover:text-green-700 transition"><i class="ri-user-heart-line text-2xl"></i><span class="text-xs">Bemorlar</span></a></li>
      <li><a href="./dental_chart.html" class="flex flex-col items-center text-gray-400 hover:text-green-700 transition"><i class="ri-tooth-line text-2xl"></i><span class="text-xs">Chart</span></a></li>
      <li><a href="./profil.html" class="flex flex-col items-center text-green-700"><i class="ri-user-settings-line text-2xl"></i><span class="text-xs">Profil</span></a></li>
    </ul>
  </nav>

  <!-- ‚öôÔ∏è Script -->
  <script>
    const API_DOCTORS = "https://shifo-crm-7.onrender.com/doctors";
    const API_REMINDERS = "https://shifo-crm-7.onrender.com/reminders";
    const doctor = JSON.parse(localStorage.getItem("doctor"));
    if (!doctor) window.location.href = "register.html";

    const fullnameEl = document.getElementById("fullname");
    const usernameEl = document.getElementById("username");
    const passwordEl = document.getElementById("password");
    const phoneEl = document.getElementById("phone");
    const profileNameEl = document.getElementById("profileName");
    const profileAvatarEl = document.getElementById("profileAvatar");

    function renderProfile() {
      fullnameEl.textContent = doctor.fullname;
      usernameEl.textContent = doctor.username;
      passwordEl.textContent = "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢";
      phoneEl.textContent = doctor.phone || "-";
      profileNameEl.textContent = doctor.fullname;
      profileAvatarEl.textContent = doctor.fullname.charAt(0).toUpperCase();
    }
    renderProfile();

    // Logout
    function logout() {
      localStorage.removeItem("doctor");
      window.location.href = "register.html";
    }

    // Edit profile
    const editModal = document.getElementById("editModal");
    document.getElementById("editBtn").onclick = () => {
      document.getElementById("editFullname").value = doctor.fullname;
      document.getElementById("editUsername").value = doctor.username;
      document.getElementById("editPassword").value = doctor.password;
      document.getElementById("editPhone").value = doctor.phone || "";
      editModal.classList.remove("hidden");
    };
    document.getElementById("cancelEdit").onclick = () => editModal.classList.add("hidden");

    document.getElementById("editForm").onsubmit = async (e) => {
      e.preventDefault();
      const updated = {
        ...doctor,
        fullname: editFullname.value,
        username: editUsername.value,
        password: editPassword.value,
        phone: editPhone.value
      };
      await fetch(`${API_DOCTORS}/${doctor.id}`, {
        method: "PUT", headers: { "Content-Type": "application/json" }, body: JSON.stringify(updated)
      });
      localStorage.setItem("doctor", JSON.stringify(updated));
      alert("‚úÖ Ma‚Äôlumotlar saqlandi!");
      editModal.classList.add("hidden");
      location.reload();
    };

    // Sidebar toggle (mobile)
    const sidebar = document.getElementById("sidebar");
    document.getElementById("openSidebar").onclick = () => sidebar.classList.toggle("hidden");

    // Reminders
    const reminderModal = document.getElementById("reminderModal");
    const reminderForm = document.getElementById("reminderForm");
    const reminderList = document.getElementById("reminderList");
    let reminders = [], editId = null;

    async function loadReminders() {
      const res = await fetch(`${API_REMINDERS}?doctorId=${doctor.id}`);
      reminders = await res.json();
      renderReminders();
    }

    function renderReminders() {
      reminderList.innerHTML = reminders.length ? "" : `<p class="text-gray-500 italic">Eslatmalar yo‚Äòq.</p>`;
      reminders.forEach(r => {
        const li = document.createElement("li");
        li.className = "p-4 border rounded-xl flex justify-between hover:bg-gray-50";
        li.innerHTML = `
          <div>
            <p class="font-medium">${r.text}</p>
            <p class="text-sm text-gray-500"><i class="ri-time-line"></i> ${new Date(r.date).toLocaleString()}</p>
          </div>
          <div class="flex gap-3">
            <button onclick="editReminder('${r.id}')" class="text-green-600"><i class="ri-edit-2-line"></i></button>
            <button onclick="deleteReminder('${r.id}')" class="text-red-500"><i class="ri-delete-bin-line"></i></button>
          </div>`;
        reminderList.appendChild(li);
      });
    }

    addReminderBtn.onclick = () => {
      editId = null;
      reminderForm.reset();
      reminderModal.classList.remove("hidden");
    };
    cancelReminder.onclick = () => reminderModal.classList.add("hidden");

    reminderForm.onsubmit = async (e) => {
      e.preventDefault();
      const data = { text: reminderText.value, date: reminderDate.value, doctorId: doctor.id };
      if (editId) await fetch(`${API_REMINDERS}/${editId}`, { method: "PUT", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ ...data, id: editId }) });
      else await fetch(API_REMINDERS, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ ...data, id: "r" + Date.now() }) });
      reminderModal.classList.add("hidden");
      await loadReminders();
    };

    window.editReminder = async (id) => {
      const rem = reminders.find(r => r.id === id);
      if (!rem) return;
      editId = id;
      reminderText.value = rem.text;
      reminderDate.value = rem.date;
      reminderModal.classList.remove("hidden");
    };

    window.deleteReminder = async (id) => {
      if (confirm("üóëÔ∏è Eslatmani o‚Äòchirishni xohlaysizmi?")) {
        await fetch(`${API_REMINDERS}/${id}`, { method: "DELETE" });
        await loadReminders();
      }
    };

    loadReminders();
  </script>
</body>
</html>
